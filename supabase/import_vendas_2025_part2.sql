-- ============================================
-- IMPORTAÇÃO DE HISTÓRICO DE VENDAS (PARTE 2)
-- ============================================

DO $$ 
DECLARE 
  v_user_id UUID;
BEGIN
  SELECT id INTO v_user_id FROM auth.users LIMIT 1;
  
  CREATE TEMP TABLE raw_data_import_2 (
    dt DATE,
    code TEXT,
    qty INT,
    price DECIMAL
  );

  INSERT INTO raw_data_import_2 (dt, code, qty, price) VALUES
  -- JULHO
  ('2025-07-09', 'AR22', 5, 5),
  ('2025-07-27', 'AR22', 1, 1),
  ('2025-07-25', 'AR5065', 1, 25),
  ('2025-07-14', 'AR5065', 2, 30),
  ('2025-07-29', 'AR5065', 4, 12),
  ('2025-07-01', 'AR5368', 2, 7),
  ('2025-07-22', 'AR5370', 2, 20),
  ('2025-07-10', 'AR5535', 1, 30),
  ('2025-07-08', 'AR5543', 1, 23),
  ('2025-07-13', 'AR5557', 2, 8),
  ('2025-07-10', 'AR5567', 2, 40),
  ('2025-07-02', 'AR5786', 1, 3),
  ('2025-07-22', 'AR5947', 1, 6),
  ('2025-07-03', 'AR6059', 1, 10),
  ('2025-07-01', 'AR6060', 1, 3),
  ('2025-07-31', 'AR6060', 1, 6),
  ('2025-07-18', 'AR6066', 2, 6),
  ('2025-07-01', 'AR6066', 2, 5),
  ('2025-07-01', 'AR6066', 1, 5),
  ('2025-07-20', 'AR6066', 1, 3),
  ('2025-07-24', 'AR6066', 1, 6),
  ('2025-07-09', 'AR6170', 1, 15),
  ('2025-07-20', 'AR6170', 4, 12),
  ('2025-07-29', 'AR6178', 1, 25),
  ('2025-07-27', 'AR6190', 2, 8),
  ('2025-07-20', 'AR6235', 1, 4),
  ('2025-07-01', 'AR6425', 1, 10),
  ('2025-07-04', 'AR7491', 1, 30),
  ('2025-07-24', 'AR7509', 2, 20),
  ('2025-07-07', 'AR7527', 2, 24),
  ('2025-07-02', 'AR7571', 1, 7),
  ('2025-07-20', 'AR7579', 2, 12),
  ('2025-07-03', 'AR7590', 1, 9),
  ('2025-07-04', 'AR7590', 1, 9),
  ('2025-07-05', 'AR7616', 2, 20),
  ('2025-07-31', 'AR7616', 1, 25),
  ('2025-07-04', 'AR7654', 1, 10),
  ('2025-07-05', 'AR8571', 1, 18),
  ('2025-07-31', 'AR8571', 1, 15),
  ('2025-07-05', 'AR8572', 1, 15),
  ('2025-07-04', 'BJ1050', 2, 30),
  ('2025-07-14', 'BJ1050', 2, 30),
  ('2025-07-27', 'BJ1052', 2, 30),
  ('2025-07-31', 'BJ1160', 2, 28),
  ('2025-07-16', 'BJ1180', 2, 36),
  ('2025-07-22', 'BJ1287', 2, 34),
  ('2025-07-15', 'BJ958', 1, 18),
  ('2025-07-04', 'BJ966', 2, 28),
  ('2025-07-13', 'BJ966', 1, 14),
  ('2025-07-20', 'BJ967', 1, 17),
  ('2025-07-08', 'BJ994', 2, 40),
  ('2025-07-20', 'BJ994', 1, 20),
  ('2025-07-31', 'BJ994', 2, 50),
  ('2025-07-29', 'CLUTCH MASTER', 1, 35),
  ('2025-07-05', 'CSK206-0978', 1, 5),
  ('2025-07-08', 'CV22', 1, 8),
  ('2025-07-24', 'CV22', 1, 10),
  ('2025-07-10', 'CV33', 1, 8),
  ('2025-07-04', 'CV35', 1, 10),
  ('2025-07-03', 'FP007', 1, 35),
  ('2025-07-24', 'FP007', 1, 30),
  ('2025-07-27', 'FP007', 1, 34),
  ('2025-07-05', 'FP008', 1, 35),
  ('2025-07-08', 'FP008', 1, 30),
  ('2025-07-15', 'FP008', 1, 32),
  ('2025-07-27', 'FP008', 1, 33),
  ('2025-07-10', 'HUB178', 1, 55),
  ('2025-07-30', 'IA5579', 1, 35),
  ('2025-07-01', 'PQ234', 1, 18),
  ('2025-07-20', 'PQ234', 1, 15),
  ('2025-07-30', 'PQ578', 1, 20),
  ('2025-07-27', 'PQ758', 1, 40),
  ('2025-07-09', 'RB9589', 1, 19),
  ('2025-07-30', 'RB9630', 1, 20),
  ('2025-07-10', 'SR83', 1, 6),
  ('2025-07-04', 'TR05343A', 1, 20),
  ('2025-07-05', 'TR05960', 2, 28),
  ('2025-07-27', 'TR5343A', 1, 20),
  ('2025-07-18', 'TR5812', 1, 25),
  ('2025-07-27', 'TR5913', 2, 24),
  ('2025-07-31', 'TR6182', 1, 14),
  -- AGOSTO
  ('2025-08-12', 'AR22', 1, 1),
  ('2025-08-19', 'AR32', 8, 10),
  ('2025-08-27', 'AR5065', 1, 25),
  ('2025-08-04', 'AR5299', 1, 30), -- wait, data shows 04-Aug-23 in context of 2025? No, user header says 2025.
  ('2025-08-04', 'AR5308', 2, 33),
  ('2025-08-12', 'AR5359', 1, 10),
  ('2025-08-12', 'AR5359', 2, 10),
  ('2025-08-19', 'AR5359', 2, 20),
  ('2025-08-25', 'AR5368', 2, 6),
  ('2025-08-25', 'AR5379', 1, 25),
  ('2025-08-05', 'AR5552', 1, 25),
  ('2025-08-28', 'AR5647', 2, 16),
  ('2025-08-28', 'AR5648', 2, 6),
  ('2025-08-05', 'AR5760', 1, 10),
  ('2025-08-12', 'AR5760', 2, 10),
  ('2025-08-25', 'AR5786', 1, 6),
  ('2025-08-05', 'AR5940', 2, 8),
  ('2025-08-07', 'AR5940', 2, 8),
  ('2025-08-04', 'AR6055', 4, 12),
  ('2025-08-06', 'AR6060', 1, 5),
  ('2025-08-04', 'AR6168', 2, 16),
  ('2025-08-26', 'AR6168', 2, 18),
  ('2025-08-28', 'AR6170', 1, 10),
  ('2025-08-01', 'AR6183', 1, 25),
  ('2025-08-07', 'AR6190', 2, 8),
  ('2025-08-18', 'AR6190', 2, 16),
  ('2025-08-06', 'AR6450', 2, 20),
  ('2025-08-19', 'AR6450', 1, 40),
  ('2025-08-20', 'AR6971', 1, 10),
  ('2025-08-02', 'AR7448', 1, 15),
  ('2025-08-31', 'AR7448', 4, 48),
  ('2025-08-20', 'AR7490', 2, 18),
  ('2025-08-11', 'PQ234', 1, 15),
  ('2025-08-20', 'AR8571', 2, 30),
  ('2025-08-11', 'BJ1050', 1, 30),
  ('2025-08-20', 'BJ1052', 2, 30),
  ('2025-08-08', 'BJ1160', 2, 30),
  ('2025-08-19', 'BJ1180', 1, 20),
  ('2025-08-31', 'BJ1197', 2, 40),
  ('2025-08-09', 'BJ940', 1, 10),
  ('2025-08-06', 'BJ960', 1, 14),
  ('2025-08-19', 'BJ967', 2, 36),
  ('2025-08-20', 'BJ969', 1, 18),
  ('2025-08-28', 'BJ969', 1, 15),
  ('2025-08-31', 'CS302', 2, 150),
  ('2025-08-26', 'CV22', 2, 18),
  ('2025-08-20', 'CV33', 1, 8),
  ('2025-08-28', 'CV33', 1, 8),
  ('2025-08-11', 'CV35', 1, 8),
  ('2025-08-25', 'CV35', 1, 8),
  ('2025-08-29', 'CV35', 1, 10),
  ('2025-08-12', 'FP004', 1, 30),
  ('2025-08-29', 'FP004', 1, 35),
  ('2025-08-02', 'FP008', 1, 34),
  ('2025-08-02', 'FP008', 1, 30),
  ('2025-08-11', 'FP008', 1, 35),
  ('2025-08-20', 'FP008', 1, 35),
  ('2025-08-26', 'FP04', 1, 35),
  ('2025-08-05', 'CM159-5400', 1, 35),
  ('2025-08-20', 'PQ178', 1, 18),
  ('2025-08-26', 'PQ178', 1, 15),
  ('2025-08-18', 'PQ598', 2, 38),
  ('2025-08-07', 'PQ758', 2, 40),
  ('2025-08-05', 'RB9589', 1, 20),
  ('2025-08-20', 'SR1', 1, 5),
  ('2025-08-09', 'TR05470', 1, 25),
  ('2025-08-31', 'TR05916', 1, 28),
  ('2025-08-31', 'TR06150', 2, 36),
  ('2025-08-31', 'TR06266', 2, 40),
  ('2025-08-08', 'TR5959', 1, 25),
  ('2025-08-08', 'TR5960', 2, 28),
  -- SETEMBRO
  ('2025-09-18', 'AR22', 6, 6),
  ('2025-09-06', 'AR33', 4, 4),
  ('2025-09-19', 'AR33', 1, 2),
  ('2025-09-09', 'AR5065', 1, 25),
  ('2025-09-20', 'AR5149', 1, 5),
  ('2025-09-21', 'AR5319', 5, 15),
  ('2025-09-11', 'AR5379', 1, 25),
  ('2025-09-29', 'AR5535', 2, 30),
  ('2025-09-09', 'AR5567', 2, 20),
  ('2025-09-01', 'AR5647', 1, 5),
  ('2025-09-15', 'AR5946', 2, 12),
  ('2025-09-21', 'AR6058', 4, 12),
  ('2025-09-06', 'AR6060', 2, 10),
  ('2025-09-12', 'AR6066', 1, 6),
  ('2025-09-15', 'AR6066', 2, 6),
  ('2025-09-18', 'AR6066', 1, 6),
  ('2025-09-04', 'AR6190', 1, 8),
  ('2025-09-15', 'AR6414', 1, 25),
  ('2025-09-10', 'AR7654', 2, 12),
  ('2025-09-29', 'AR7654', 2, 10),
  ('2025-09-02', 'AR8064', 2, 20),
  ('2025-09-02', 'AR8065', 2, 20),
  ('2025-09-21', 'AR8136', 2, 6),
  ('2025-09-11', 'AR8474', 2, 40),
  ('2025-09-10', 'AR8571', 1, 15),
  ('2025-09-17', 'AR8799', 2, 30),
  ('2025-09-01', 'BJ1073', 1, 20),
  ('2025-09-11', 'BJ1145', 1, 14),
  ('2025-09-11', 'BJ1180', 1, 20),
  ('2025-09-09', 'BJ962', 1, 12),
  ('2025-09-21', 'BJ994', 2, 20),
  ('2025-09-17', 'CV33', 1, 8),
  ('2025-09-04', 'CV35', 1, 10),
  ('2025-09-17', 'CV35', 1, 8),
  ('2025-09-12', 'FP004', 1, 35),
  ('2025-09-21', 'FP004', 2, 67),
  ('2025-09-05', 'FP007', 1, 35),
  ('2025-09-01', 'FP008', 1, 35),
  ('2025-09-02', 'FP008', 1, 33),
  ('2025-09-04', 'FP008', 1, 34),
  ('2025-09-21', 'FP008', 1, 32),
  ('2025-09-09', 'IA5579B', 1, 35),
  ('2025-09-01', 'IA5587', 1, 35),
  ('2025-09-11', 'PQ134', 1, 15),
  ('2025-09-19', 'PQ641', 1, 20),
  ('2025-09-01', 'RB9589', 1, 20),
  ('2025-09-29', 'RB9589', 1, 20),
  ('2025-09-10', 'RB9603', 1, 20),
  ('2025-09-05', 'AR6607', 1, 10),
  ('2025-09-21', 'TR05463', 1, 24),
  ('2025-09-17', 'TR05467', 2, 25),
  ('2025-09-01', 'TR05556', 2, 30),
  ('2025-09-01', 'TR05557', 2, 25),
  ('2025-09-15', 'AR5946', 2, 12),
  -- OUTUBRO
  ('2025-10-17', 'AR22', 4, 4),
  ('2025-10-17', 'AR22', 4, 8),
  ('2025-10-17', 'AR32', 3, 6),
  ('2025-10-10', 'AR33', 2, 2),
  ('2025-10-19', 'AR33', 4, 5),
  ('2025-10-15', 'AR5299', 1, 35),
  ('2025-10-28', 'AR5310', 2, 30),
  ('2025-10-01', 'AR5370', 1, 10),
  ('2025-10-23', 'AR5647', 2, 40),
  ('2025-10-26', 'AR5647', 2, 40),
  ('2025-10-15', 'AR5786', 1, 6),
  ('2025-10-14', 'AR6036', 1, 5),
  ('2025-10-14', 'AR6066', 1, 5),
  ('2025-10-28', 'AR6066', 1, 3),
  ('2025-10-17', 'AR6168', 1, 8),
  ('2025-10-17', 'AR6425', 1, 10),
  ('2025-10-12', 'AR6430', 2, 8),
  ('2025-10-15', 'AR6430', 1, 8),
  ('2025-10-22', 'AR6430', 2, 6),
  ('2025-10-17', 'AR6619', 1, 10),
  ('2025-10-23', 'AR7509', 2, 20),
  ('2025-10-19', 'AR7615', 2, 40),
  ('2025-10-13', 'AR7617', 1, 22),
  ('2025-10-19', 'AR7617', 1, 25),
  ('2025-10-02', 'AR7654', 2, 12),
  ('2025-10-17', 'AR8064', 2, 20),
  ('2025-10-17', 'AR8065', 2, 20),
  ('2025-10-09', 'AR8367', 2, 24),
  ('2025-10-02', 'AR8798', 2, 20),
  ('2025-10-03', 'BJ1099', 2, 40),
  ('2025-10-19', 'BJ1160', 1, 15),
  ('2025-10-03', 'BJ1286', 1, 15),
  ('2025-10-26', 'BJ930', 1, 30),
  ('2025-10-17', 'BJ952', 1, 12),
  ('2025-10-28', 'BJ966', 1, 14),
  ('2025-10-26', 'BJ969', 2, 36),
  ('2025-10-26', 'BJ996', 1, 18),
  ('2025-10-03', 'CS382', 2, 50),
  ('2025-10-07', 'CV409', 2, 18),
  ('2025-10-26', 'CV409', 1, 10),
  ('2025-10-03', 'DL5543', 1, 115),
  ('2025-10-07', 'FP007', 1, 33),
  ('2025-10-07', 'FP007', 1, 34),
  ('2025-10-26', 'FP007', 1, 35),
  ('2025-10-26', 'FP007', 1, 35),
  ('2025-10-28', 'FP008', 2, 70),
  ('2025-10-09', 'FP027', 1, 33),
  ('2025-10-14', 'HUB758', 2, 60),
  ('2025-10-15', 'IA5542', 1, 35),
  ('2025-10-22', 'IA5542', 1, 35),
  ('2025-10-19', 'IA5579B', 1, 35),
  ('2025-10-13', 'IA5590', 1, 30),
  ('2025-10-01', 'PQ176', 1, 20),
  ('2025-10-19', 'PQ234', 1, 15),
  ('2025-10-22', 'PQ377', 1, 18),
  ('2025-10-14', 'PQ758', 2, 40),
  ('2025-10-23', 'RB6971', 1, 25),
  ('2025-10-13', 'RB9603', 1, 20),
  ('2025-10-14', 'RB9603', 1, 20),
  ('2025-10-15', 'RB9697', 1, 15),
  ('2025-10-02', 'TR05470', 1, 30),
  ('2025-10-15', 'TR05960', 2, 28),
  ('2025-10-23', 'TR05960', 2, 28),
  ('2025-10-03', 'CV35', 1, 8),
  ('2025-10-14', 'CV35', 1, 8),
  ('2025-10-22', 'TR5523', 1, 25),
  ('2025-10-22', 'TR5524', 1, 25),
  ('2025-10-02', 'TR5959', 1, 25),
  ('2025-10-02', 'TR5960', 1, 24),
  -- NOVEMBRO
  ('2025-11-02', 'AR22', 3, 3),
  ('2025-11-05', 'AR22', 8, 8),
  ('2025-11-03', 'AR5543', 2, 12),
  ('2025-11-01', 'AR5557', 1, 6),
  ('2025-11-06', 'AR5557', 2, 6),
  ('2025-11-12', 'AR5776', 1, 24),
  ('2025-11-09', 'AR5782', 1, 5),
  ('2025-11-03', 'AR5786', 1, 3),
  ('2025-11-06', 'AR5910', 4, 12),
  ('2025-11-06', 'AR5910', 2, 6),
  ('2025-11-10', 'AR5940', 1, 4),
  ('2025-11-04', 'AR5946', 2, 24),
  ('2025-11-05', 'AR6051', 2, 18),
  ('2025-11-05', 'AR6052', 1, 24),
  ('2025-11-12', 'AR6170', 3, 9),
  ('2025-11-10', 'AR6190', 1, 8),
  ('2025-11-08', 'AR6425', 1, 20),
  ('2025-11-02', 'AR6607', 1, 10),
  ('2025-11-05', 'AR6971', 1, 8),
  ('2025-11-05', 'AR7541', 1, 30),
  ('2025-11-08', 'AR7578', 1, 24),
  ('2025-11-12', 'AR7591', 2, 30),
  ('2025-11-03', 'AR7617', 2, 12),
  ('2025-11-13', 'AR7617', 1, 25),
  ('2025-11-12', 'AR7671', 1, 25),
  ('2025-11-03', 'AR8781', 1, 14),
  ('2025-11-10', 'AR8781', 1, 15),
  ('2025-11-03', 'AR8782', 1, 14),
  ('2025-11-05', 'BJ1137', 2, 30),
  ('2025-11-03', 'BJ1160', 1, 15),
  ('2025-11-10', 'BJ1180', 2, 35),
  ('2025-11-08', 'BJ966', 1, 15),
  ('2025-11-08', 'IA5542', 1, 35),
  ('2025-11-02', 'FP004', 1, 34),
  ('2025-11-03', 'FP004', 1, 34),
  ('2025-11-08', 'FP042', 1, 32),
  ('2025-11-03', 'PQ758', 2, 40),
  ('2025-11-09', 'TR05699', 1, 25),
  ('2025-11-05', 'TR6182', 1, 24),
  ('2025-11-10', 'TR6430', 2, 28),
  ('2025-11-10', 'TR8781', 1, 15);

  -- INSERIR NA TABELA VENDAS JOINANDO COM PEÇAS
  INSERT INTO public.vendas (
    numero_venda,
    peca_id, 
    peca_codigo, 
    peca_nome, 
    quantidade, 
    preco_unitario, 
    created_at, 
    user_id, 
    status,
    updated_at
  )
  SELECT 
    'V2025-' || LPAD((ROW_NUMBER() OVER (ORDER BY r.dt) + 500)::TEXT, 6, '0'),
    p.id, 
    p.codigo, 
    p.nome, 
    r.qty, 
    r.price, 
    r.dt::TIMESTAMP, 
    v_user_id, 
    'confirmada',
    NOW()
  FROM raw_data_import_2 r
  JOIN public.pecas p ON p.codigo = r.code;

  DROP TABLE raw_data_import_2;
END $$;
