<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio T√©cnico PartQuip SaaS</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; color: #333; }
        h1 { color: #2563eb; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; }
        h2 { color: #1e40af; margin-top: 30px; }
        h3 { color: #1f2937; }
        code { background: #f3f4f6; padding: 2px 5px; border-radius: 4px; font-family: Consolas, monospace; }
        pre { background: #f3f4f6; padding: 15px; border-radius: 8px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #d1d5db; padding: 12px; text-align: left; }
        th { background-color: #f9fafb; }
        blockquote { border-left: 4px solid #2563eb; margin: 0; padding-left: 15px; color: #4b5563; }
        .meta { color: #6b7280; font-size: 0.9em; margin-bottom: 30px; }
    </style>
</head>
<body>
    <h1>üèóÔ∏è Relat√≥rio de Viabilidade e Arquitetura: Migra√ß√£o para SaaS (Multi-empresa)</h1>
    
    <div class="meta">
        <p><strong>Data:</strong> 23 de Janeiro de 2026<br>
        <strong>Projeto:</strong> PartQuip<br>
        <strong>Autor:</strong> Antigravity AI</p>
    </div>

    <h2>1. Vis√£o Geral</h2>
    <p>Este documento detalha as mudan√ßas necess√°rias para transformar o sistema <strong>PartQuip</strong> (atualmente Single-Tenant) em uma plataforma <strong>SaaS Multi-Tenant</strong> (Software as a Service), permitindo que m√∫ltiplas oficinas/empresas utilizem a mesma infraestrutura de forma isolada e segura.</p>

    <h2>2. Padr√£o de Arquitetura Proposto</h2>
    <p>Recomendamos a estrat√©gia de <strong>Isolamento L√≥gico (Row-Level Security)</strong>, que √© a mais eficiente e escal√°vel para aplica√ß√µes modernas com Supabase/PostgreSQL.</p>

    <h3>Como funciona:</h3>
    <ul>
        <li>Todas as empresas compartilham o mesmo banco de dados e as mesmas tabelas.</li>
        <li>Cada registro no banco possui uma coluna <code>organization_id</code> (ID da empresa).</li>
        <li>Pol√≠ticas de Seguran√ßa (RLS) garantem que uma empresa <strong>nunca</strong> veja os dados de outra.</li>
    </ul>

    <h2>3. Altera√ß√µes Necess√°rias</h2>

    <h3>A. Banco de Dados (Supabase)</h3>
    <ol>
        <li><strong>Nova Tabela <code>organizations</code></strong>:
            <ul>
                <li><code>id</code> (UUID, PK)</li>
                <li><code>name</code> (Nome da empresa)</li>
                <li><code>slug</code> (URL amig√°vel)</li>
                <li><code>plan</code> (free, pro, enterprise)</li>
                <li><code>owner_id</code> (refer√™ncia ao usu√°rio dono)</li>
            </ul>
        </li>
        <li><strong>Nova Tabela <code>organization_members</code></strong>:
            <ul>
                <li><code>organization_id</code> (FK)</li>
                <li><code>user_id</code> (FK para <code>auth.users</code>)</li>
                <li><code>role</code> (admin, vendedor, estoquista)</li>
            </ul>
        </li>
        <li><strong>Altera√ß√£o em TODAS as Tabelas Existentes</strong>:
            <ul>
                <li>Adicionar coluna <code>organization_id</code> (UUID, Not Null, FK)</li>
            </ul>
        </li>
        <li><strong>Atualiza√ß√£o de RLS (Row Level Security)</strong>:</li>
    </ol>
    <pre><code>CREATE POLICY "Acesso por Organiza√ß√£o" ON pecas
USING (organization_id IN (
    SELECT organization_id FROM organization_members 
    WHERE user_id = auth.uid()
));</code></pre>

    <h3>B. Frontend (Aplica√ß√£o)</h3>
    <ol>
        <li><strong>Contexto de Organiza√ß√£o</strong>: Criar React Context global.</li>
        <li><strong>Fluxo de Onboarding</strong>: Criar empresa ao cadastrar.</li>
        <li><strong>Refatora√ß√£o de CRUD</strong>: Todos os inserts devem incluir <code>organization_id</code>.</li>
        <li><strong>Gest√£o de Membros</strong>: Tela de convites e permiss√µes.</li>
    </ol>

    <h2>4. Impacto e Riscos</h2>
    <table>
        <thead>
            <tr>
                <th>√Årea</th>
                <th>Impacto</th>
                <th>Risco</th>
                <th>Mitiga√ß√£o</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Banco de Dados</td>
                <td>Alto</td>
                <td>Alto</td>
                <td>Testes rigorosos de RLS.</td>
            </tr>
            <tr>
                <td>C√≥digo Frontend</td>
                <td>M√©dio</td>
                <td>M√©dio</td>
                <td>Refatora√ß√£o gradual.</td>
            </tr>
            <tr>
                <td>Migra√ß√£o</td>
                <td>Alto</td>
                <td>M√©dio</td>
                <td>Backup e script de migra√ß√£o cuidadoso.</td>
            </tr>
        </tbody>
    </table>

    <h2>5. Estimativa de Esfor√ßo</h2>
    <ul>
        <li><strong>Total Estimado:</strong> ~2 semanas de desenvolvimento focado.</li>
    </ul>

    <h2>6. Conclus√£o</h2>
    <p>A migra√ß√£o √© vi√°vel mas recomendada para a vers√£o 2.0.0, em um branch dedicado.</p>
</body>
</html>
